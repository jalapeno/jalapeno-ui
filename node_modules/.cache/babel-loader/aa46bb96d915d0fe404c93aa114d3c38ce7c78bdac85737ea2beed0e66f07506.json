{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar layout_1 = require(\"./layout\");\nvar gridrouter_1 = require(\"./gridrouter\");\nfunction gridify(pgLayout, nudgeGap, margin, groupMargin) {\n  pgLayout.cola.start(0, 0, 0, 10, false);\n  var gridrouter = route(pgLayout.cola.nodes(), pgLayout.cola.groups(), margin, groupMargin);\n  return gridrouter.routeEdges(pgLayout.powerGraph.powerEdges, nudgeGap, function (e) {\n    return e.source.routerNode.id;\n  }, function (e) {\n    return e.target.routerNode.id;\n  });\n}\nexports.gridify = gridify;\nfunction route(nodes, groups, margin, groupMargin) {\n  nodes.forEach(function (d) {\n    d.routerNode = {\n      name: d.name,\n      bounds: d.bounds.inflate(-margin)\n    };\n  });\n  groups.forEach(function (d) {\n    d.routerNode = {\n      bounds: d.bounds.inflate(-groupMargin),\n      children: (typeof d.groups !== 'undefined' ? d.groups.map(function (c) {\n        return nodes.length + c.id;\n      }) : []).concat(typeof d.leaves !== 'undefined' ? d.leaves.map(function (c) {\n        return c.index;\n      }) : [])\n    };\n  });\n  var gridRouterNodes = nodes.concat(groups).map(function (d, i) {\n    d.routerNode.id = i;\n    return d.routerNode;\n  });\n  return new gridrouter_1.GridRouter(gridRouterNodes, {\n    getChildren: function (v) {\n      return v.children;\n    },\n    getBounds: function (v) {\n      return v.bounds;\n    }\n  }, margin - groupMargin);\n}\nfunction powerGraphGridLayout(graph, size, grouppadding) {\n  var powerGraph;\n  graph.nodes.forEach(function (v, i) {\n    return v.index = i;\n  });\n  new layout_1.Layout().avoidOverlaps(false).nodes(graph.nodes).links(graph.links).powerGraphGroups(function (d) {\n    powerGraph = d;\n    powerGraph.groups.forEach(function (v) {\n      return v.padding = grouppadding;\n    });\n  });\n  var n = graph.nodes.length;\n  var edges = [];\n  var vs = graph.nodes.slice(0);\n  vs.forEach(function (v, i) {\n    return v.index = i;\n  });\n  powerGraph.groups.forEach(function (g) {\n    var sourceInd = g.index = g.id + n;\n    vs.push(g);\n    if (typeof g.leaves !== 'undefined') g.leaves.forEach(function (v) {\n      return edges.push({\n        source: sourceInd,\n        target: v.index\n      });\n    });\n    if (typeof g.groups !== 'undefined') g.groups.forEach(function (gg) {\n      return edges.push({\n        source: sourceInd,\n        target: gg.id + n\n      });\n    });\n  });\n  powerGraph.powerEdges.forEach(function (e) {\n    edges.push({\n      source: e.source.index,\n      target: e.target.index\n    });\n  });\n  new layout_1.Layout().size(size).nodes(vs).links(edges).avoidOverlaps(false).linkDistance(30).symmetricDiffLinkLengths(5).convergenceThreshold(1e-4).start(100, 0, 0, 0, false);\n  return {\n    cola: new layout_1.Layout().convergenceThreshold(1e-3).size(size).avoidOverlaps(true).nodes(graph.nodes).links(graph.links).groupCompactness(1e-4).linkDistance(30).symmetricDiffLinkLengths(5).powerGraphGroups(function (d) {\n      powerGraph = d;\n      powerGraph.groups.forEach(function (v) {\n        v.padding = grouppadding;\n      });\n    }).start(50, 0, 100, 0, false),\n    powerGraph: powerGraph\n  };\n}\nexports.powerGraphGridLayout = powerGraphGridLayout;","map":{"version":3,"names":["layout_1","require","gridrouter_1","gridify","pgLayout","nudgeGap","margin","groupMargin","cola","start","gridrouter","route","nodes","groups","routeEdges","powerGraph","powerEdges","e","source","routerNode","id","target","exports","forEach","d","name","bounds","inflate","children","map","c","length","concat","leaves","index","gridRouterNodes","i","GridRouter","getChildren","v","getBounds","powerGraphGridLayout","graph","size","grouppadding","Layout","avoidOverlaps","links","powerGraphGroups","padding","n","edges","vs","slice","g","sourceInd","push","gg","linkDistance","symmetricDiffLinkLengths","convergenceThreshold","groupCompactness"],"sources":["/Users/brucemcdougall/go/jalapeno-github/jalapeno-ui/node_modules/webcola/WebCola/src/batch.ts"],"sourcesContent":["import {Node, Link, Layout} from './layout'\r\nimport {GridRouter} from './gridrouter'\r\nimport {Point} from './geom'\r\n\r\n/**\r\n * @property nudgeGap spacing between parallel edge segments\r\n * @property margin space around nodes\r\n * @property groupMargin space around groups\r\n */\r\nexport function gridify(pgLayout, nudgeGap: number, margin: number, groupMargin: number) {\r\n    pgLayout.cola.start(0, 0, 0, 10, false);\r\n    let gridrouter = route(pgLayout.cola.nodes(), pgLayout.cola.groups(), margin, groupMargin);\r\n    return gridrouter.routeEdges<any>(pgLayout.powerGraph.powerEdges, nudgeGap, e=> e.source.routerNode.id, e=> e.target.routerNode.id);\r\n}\r\n\r\nfunction route(nodes, groups, margin: number, groupMargin: number) {\r\n    nodes.forEach(d => {\r\n        d.routerNode = <any>{\r\n            name: d.name,\r\n            bounds: d.bounds.inflate(-margin)\r\n        };\r\n    });\r\n    groups.forEach(d => {\r\n        d.routerNode = <any>{\r\n            bounds: d.bounds.inflate(-groupMargin),\r\n            children: (typeof d.groups !== 'undefined' ? d.groups.map(c=> nodes.length + c.id) : [])\r\n                .concat(typeof d.leaves !== 'undefined' ? d.leaves.map(c=> c.index) : [])\r\n        };\r\n    });\r\n    let gridRouterNodes = nodes.concat(groups).map((d, i) => {\r\n        d.routerNode.id = i;\r\n        return d.routerNode;\r\n    });\r\n    return new GridRouter(gridRouterNodes, {\r\n        getChildren: (v: any) => v.children,\r\n        getBounds: v => v.bounds\r\n    }, margin - groupMargin);\r\n}\r\n\r\nexport function powerGraphGridLayout(\r\n    graph: { nodes: Node[], links: Link<Node>[] },\r\n    size: number[],\r\n    grouppadding: number)\r\n{\r\n    // compute power graph\r\n    var powerGraph;\r\n    graph.nodes.forEach((v,i) => (<any>v).index = i);\r\n    new Layout()\r\n        .avoidOverlaps(false)\r\n        .nodes(graph.nodes)\r\n        .links(graph.links)\r\n        .powerGraphGroups(function (d) {\r\n            powerGraph = d;\r\n            powerGraph.groups.forEach(v=> v.padding = grouppadding);\r\n        });\r\n\r\n    // construct a flat graph with dummy nodes for the groups and edges connecting group dummy nodes to their children\r\n    // power edges attached to groups are replaced with edges connected to the corresponding group dummy node\r\n    var n = graph.nodes.length;\r\n    var edges = [];\r\n    var vs = graph.nodes.slice(0);\r\n    vs.forEach((v, i) => (<any>v).index = i);\r\n    powerGraph.groups.forEach(g => {\r\n        var sourceInd = g.index = g.id + n;\r\n        vs.push(g);\r\n        if (typeof g.leaves !== 'undefined')\r\n            g.leaves.forEach(v => edges.push({ source: sourceInd, target: v.index }));\r\n        if (typeof g.groups !== 'undefined')\r\n            g.groups.forEach(gg => edges.push({ source: sourceInd, target: gg.id + n }));\r\n    });\r\n    powerGraph.powerEdges.forEach(e=> {\r\n        edges.push({ source: e.source.index, target: e.target.index });\r\n    });\r\n\r\n    // layout the flat graph with dummy nodes and edges\r\n    new Layout()\r\n        .size(size)\r\n        .nodes(vs)\r\n        .links(edges)\r\n        .avoidOverlaps(false)\r\n        .linkDistance(30)\r\n        .symmetricDiffLinkLengths(5)\r\n        .convergenceThreshold(1e-4)\r\n        .start(100, 0, 0, 0, false);\r\n\r\n    // final layout taking node positions from above as starting positions\r\n    // subject to group containment constraints\r\n    // and then gridifying the layout\r\n    return {\r\n        cola:\r\n            new Layout()\r\n            .convergenceThreshold(1e-3)\r\n            .size(size)\r\n            .avoidOverlaps(true)\r\n            .nodes(graph.nodes)\r\n            .links(graph.links)\r\n        //.flowLayout('y', 30)\r\n            .groupCompactness(1e-4)\r\n            .linkDistance(30)\r\n            .symmetricDiffLinkLengths(5)\r\n            .powerGraphGroups(function (d) {\r\n                powerGraph = d;\r\n                powerGraph.groups.forEach(function (v) {\r\n                    v.padding = grouppadding\r\n                });\r\n            }).start(50, 0, 100, 0, false),\r\n        powerGraph: powerGraph\r\n    };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}